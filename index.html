<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CRG Internal ‚Äî Acc√®s S√©curis√©</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #F2F4F7;
  color: #1A1A2E;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ LOGIN SCREEN ‚îÄ‚îÄ */
#login-screen {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #F2F4F7;
}
.login-box {
  background: #FFFFFF;
  border: 1px solid #D6DAE4;
  border-top: 3px solid #1B3A6B;
  border-radius: 4px;
  padding: 44px 48px;
  width: 100%;
  max-width: 420px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
}
.login-logo {
  text-align: center;
  margin-bottom: 32px;
}
.login-logo-mark {
  font-family: Arial, Helvetica, sans-serif;
  font-size: 28px;
  font-weight: 700;
  color: #1B3A6B;
  letter-spacing: 2px;
}
.login-logo-sub {
  font-size: 11px;
  color: #6B7280;
  margin-top: 4px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
}
.login-divider {
  width: 40px;
  height: 2px;
  background: #1B3A6B;
  margin: 14px auto;
}
.login-title {
  font-size: 13px;
  font-weight: 700;
  color: #374151;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.login-sub {
  font-size: 12px;
  color: #9CA3AF;
  margin-bottom: 28px;
}
.login-field { margin-bottom: 16px; }
.login-label {
  display: block;
  font-size: 11px;
  font-weight: 700;
  color: #374151;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.login-input {
  width: 100%;
  border: 1px solid #D1D5DB;
  border-radius: 3px;
  padding: 10px 12px;
  font-size: 13px;
  font-family: Arial, Helvetica, sans-serif;
  color: #1A1A2E;
  background: #FAFAFA;
  outline: none;
  transition: border-color 0.15s;
}
.login-input:focus { border-color: #1B3A6B; background: #fff; }
.login-btn {
  width: 100%;
  background: #1B3A6B;
  color: #fff;
  border: none;
  border-radius: 3px;
  padding: 11px;
  font-size: 13px;
  font-weight: 700;
  font-family: Arial, Helvetica, sans-serif;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-top: 8px;
  transition: background 0.15s;
}
.login-btn:hover { background: #142D55; }
.login-error {
  background: #FEF2F2;
  border: 1px solid #FCA5A5;
  border-radius: 3px;
  padding: 9px 12px;
  font-size: 12px;
  color: #DC2626;
  margin-top: 12px;
  display: none;
}
.login-footer {
  text-align: center;
  margin-top: 28px;
  font-size: 11px;
  color: #9CA3AF;
  border-top: 1px solid #E5E7EB;
  padding-top: 16px;
}

/* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
#app { display: none; min-height: 100vh; }

/* TOPBAR */
#topbar {
  background: #1B3A6B;
  height: 54px;
  display: flex;
  align-items: center;
  padding: 0 0 0 0;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 1px 4px rgba(0,0,0,0.15);
}
.tb-brand {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 0 24px;
  border-right: 1px solid rgba(255,255,255,0.12);
  height: 100%;
  min-width: 220px;
}
.tb-logo { font-size: 17px; font-weight: 700; color: #FFFFFF; letter-spacing: 2px; }
.tb-logo-sub { font-size: 9px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1.5px; margin-top: 1px; }
.tb-nav {
  display: flex;
  align-items: center;
  height: 100%;
  flex: 1;
  padding: 0 8px;
}
.tb-nav-btn {
  height: 100%;
  padding: 0 16px;
  background: none;
  border: none;
  color: rgba(255,255,255,0.65);
  font-size: 12px;
  font-family: Arial, Helvetica, sans-serif;
  font-weight: 700;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid transparent;
  transition: all 0.15s;
  white-space: nowrap;
}
.tb-nav-btn:hover { color: #fff; }
.tb-nav-btn.active { color: #fff; border-bottom-color: #5B9BD5; }
.tb-right {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 0 20px;
  margin-left: auto;
}
.tb-date { font-size: 11px; color: rgba(255,255,255,0.5); }
.tb-user { font-size: 12px; color: rgba(255,255,255,0.8); font-weight: 700; }
.tb-logout {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 3px;
  color: rgba(255,255,255,0.7);
  font-size: 11px;
  font-family: Arial, Helvetica, sans-serif;
  padding: 5px 10px;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.tb-logout:hover { background: rgba(255,255,255,0.18); color: #fff; }
.tb-late-btn {
  display: flex; align-items: center; gap: 6px;
  background: #DC2626;
  border: none;
  border-radius: 3px;
  color: #fff;
  font-size: 11px;
  font-family: Arial, Helvetica, sans-serif;
  font-weight: 700;
  padding: 5px 10px;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

/* CONTENT */
#content {
  max-width: 1280px;
  margin: 0 auto;
  padding: 30px 32px;
}

/* PAGE HEADER */
.ph { margin-bottom: 24px; border-bottom: 1px solid #D6DAE4; padding-bottom: 20px; }
.ph-crumbs { font-size: 11px; color: #9CA3AF; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
.ph-row { display: flex; align-items: center; justify-content: space-between; }
.ph-title { font-size: 20px; font-weight: 700; color: #1B3A6B; letter-spacing: -0.3px; }
.ph-sub { font-size: 12px; color: #6B7280; margin-top: 3px; }

/* STAT GRID */
.stat-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; margin-bottom: 24px; }
.stat-card {
  background: #FFFFFF;
  border: 1px solid #D6DAE4;
  border-left: 3px solid #1B3A6B;
  padding: 18px 20px;
}
.stat-label { font-size: 10px; font-weight: 700; color: #6B7280; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; }
.stat-value { font-size: 22px; font-weight: 700; color: #1A1A2E; margin-bottom: 3px; }
.stat-sub { font-size: 11px; color: #9CA3AF; }

/* TABLE */
.table-wrap {
  background: #FFFFFF;
  border: 1px solid #D6DAE4;
}
.table-title {
  padding: 14px 18px;
  border-bottom: 1px solid #D6DAE4;
  font-size: 12px;
  font-weight: 700;
  color: #1B3A6B;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  background: #F8F9FB;
}
table { width: 100%; border-collapse: collapse; }
thead tr { background: #F8F9FB; }
th {
  padding: 10px 16px;
  font-size: 10px;
  font-weight: 700;
  color: #6B7280;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  text-align: left;
  border-bottom: 1px solid #D6DAE4;
  white-space: nowrap;
}
th.r { text-align: right; }
td { padding: 12px 16px; font-size: 12px; color: #374151; border-bottom: 1px solid #EEF0F5; }
td.r { text-align: right; }
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: #F8F9FB; }
.mono { font-family: "Courier New", monospace; font-size: 12px; font-weight: 700; color: #1B3A6B; }

/* BADGE */
.badge {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 8px; font-size: 10px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.5px;
  border-radius: 2px;
}
.badge::before { content:''; width:4px; height:4px; border-radius:50%; background:currentColor; }
.badge-green { color: #047857; background: #ECFDF5; border: 1px solid #A7F3D0; }
.badge-amber { color: #B45309; background: #FFFBEB; border: 1px solid #FCD34D; }
.badge-red   { color: #B91C1C; background: #FEF2F2; border: 1px solid #FCA5A5; }
.badge-blue  { color: #1D4ED8; background: #EFF6FF; border: 1px solid #BFDBFE; }
.badge-gray  { color: #4B5563; background: #F3F4F6; border: 1px solid #D1D5DB; }
.badge-purple{ color: #6D28D9; background: #F5F3FF; border: 1px solid #DDD6FE; }

/* BUTTONS */
.btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 7px 14px;
  font-size: 11px; font-weight: 700;
  font-family: Arial, Helvetica, sans-serif;
  text-transform: uppercase; letter-spacing: 0.5px;
  cursor: pointer; border-radius: 3px; white-space: nowrap;
  transition: all 0.12s;
}
.btn-primary { background: #1B3A6B; color: #fff; border: 1px solid #1B3A6B; }
.btn-primary:hover { background: #142D55; }
.btn-secondary { background: #fff; color: #374151; border: 1px solid #D1D5DB; }
.btn-secondary:hover { background: #F3F4F6; }
.btn-success { background: #ECFDF5; color: #047857; border: 1px solid #A7F3D0; }
.btn-success:hover { background: #D1FAE5; }
.btn-danger { background: #FEF2F2; color: #B91C1C; border: 1px solid #FCA5A5; }
.btn-danger:hover { background: #FEE2E2; }
.btn-lg { padding: 10px 20px; font-size: 12px; }
.btn-block { width: 100%; justify-content: center; }

/* CARD */
.card { background: #FFFFFF; border: 1px solid #D6DAE4; }
.card-header {
  padding: 13px 18px;
  border-bottom: 1px solid #D6DAE4;
  font-size: 11px; font-weight: 700;
  color: #1B3A6B;
  text-transform: uppercase; letter-spacing: 0.5px;
  background: #F8F9FB;
  display: flex; align-items: center; justify-content: space-between;
}
.card-body { padding: 20px 18px; }

/* FORM */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.form-grid .full { grid-column: 1/-1; }
.form-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 0; }
.form-label { font-size: 10px; font-weight: 700; color: #374151; text-transform: uppercase; letter-spacing: 0.5px; }
.form-input, .form-select, .form-textarea {
  width: 100%; border: 1px solid #D1D5DB; border-radius: 3px;
  padding: 8px 10px; font-size: 12px; color: #1A1A2E;
  background: #FAFAFA; font-family: Arial, Helvetica, sans-serif;
  outline: none; transition: border-color 0.12s;
}
.form-input:focus, .form-select:focus, .form-textarea:focus { border-color: #1B3A6B; background: #fff; }
.form-input::placeholder, .form-textarea::placeholder { color: #9CA3AF; }
.form-textarea { resize: vertical; }
.form-sep { height: 1px; background: #E5E7EB; margin: 16px 0; }
.form-footer {
  display: flex; gap: 10px; justify-content: flex-end;
  margin-top: 22px; padding-top: 16px; border-top: 1px solid #E5E7EB;
}

/* MODAL */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.45);
  z-index: 500;
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
}
.modal-box {
  background: #FFFFFF;
  border: 1px solid #D6DAE4;
  border-top: 3px solid #1B3A6B;
  width: 100%; max-width: 560px;
  max-height: 90vh; overflow-y: auto;
  box-shadow: 0 8px 40px rgba(0,0,0,0.14);
}
.modal-box.wide { max-width: 860px; }
.modal-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px 22px;
  border-bottom: 1px solid #D6DAE4;
  background: #F8F9FB;
}
.modal-title { font-size: 13px; font-weight: 700; color: #1B3A6B; text-transform: uppercase; letter-spacing: 0.5px; }
.modal-sub { font-size: 11px; color: #6B7280; margin-top: 2px; }
.modal-close {
  background: none; border: none; cursor: pointer; color: #6B7280;
  padding: 4px; font-size: 18px; line-height: 1;
}
.modal-close:hover { color: #1A1A2E; }
.modal-body { padding: 22px; }

/* ALERT */
.alert {
  display: flex; align-items: center; gap: 10px;
  padding: 11px 14px; font-size: 12px; font-weight: 700;
  margin-bottom: 20px;
}
.alert-red { background: #FEF2F2; border: 1px solid #FCA5A5; color: #B91C1C; }
.alert-blue { background: #EFF6FF; border: 1px solid #BFDBFE; color: #1D4ED8; }
.alert-amber { background: #FFFBEB; border: 1px solid #FCD34D; color: #B45309; }

/* TOAST */
.toast {
  position: fixed; bottom: 22px; right: 22px; z-index: 9999;
  background: #fff; border: 1px solid #D1D5DB;
  border-radius: 3px; padding: 12px 16px;
  display: flex; align-items: center; gap: 10px;
  font-size: 12px; color: #1A1A2E;
  box-shadow: 0 4px 16px rgba(0,0,0,0.12);
  min-width: 260px;
  animation: fadeup 0.25s ease;
}
.toast.success { border-left: 3px solid #047857; }
.toast.error   { border-left: 3px solid #DC2626; }
@keyframes fadeup { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

/* EMPTY */
.empty { padding: 48px; text-align: center; color: #9CA3AF; }
.empty-title { font-size: 13px; font-weight: 700; color: #6B7280; margin-bottom: 4px; }
.empty-sub { font-size: 12px; }

/* PROGRESS */
.progress { height: 4px; background: #E5E7EB; border-radius: 2px; overflow: hidden; margin-top: 5px; }
.progress-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }

/* FREELANCE CARD */
.fl-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; }
.fl-card { background: #fff; border: 1px solid #D6DAE4; border-top: 3px solid #1B3A6B; padding: 20px; }
.fl-initials {
  width: 42px; height: 42px; background: #E8EDF5; border: 1px solid #C5CEDF;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; font-weight: 700; color: #1B3A6B; flex-shrink: 0;
}
.fl-name { font-size: 14px; font-weight: 700; color: #1A1A2E; }
.fl-spec { font-size: 11px; color: #6B7280; }
.fl-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #EEF0F5; font-size: 11px; }
.fl-earn { margin-top: 14px; background: #F8F9FB; border: 1px solid #D6DAE4; padding: 12px 14px; display: flex; justify-content: space-between; align-items: center; }

/* PDF */
.pdf-wrap {
  background: #fff; color: #111;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 12px; line-height: 1.7;
  padding: 44px 52px;
  border: 1px solid #E5E7EB;
}
.pdf-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
.pdf-logo { font-size: 26px; font-weight: 700; color: #1B3A6B; letter-spacing: 2px; }
.pdf-logo-sub { font-size: 10px; color: #666; margin-top: 2px; }
.pdf-doc-title { font-size: 18px; font-weight: 700; color: #1B3A6B; text-align: right; text-transform: uppercase; letter-spacing: 1px; }
.pdf-doc-num { font-size: 14px; font-weight: 700; color: #374151; margin-top: 4px; text-align: right; }
.pdf-rule { height: 2px; background: #1B3A6B; margin-bottom: 24px; }
.pdf-parties { display: flex; gap: 48px; margin-bottom: 22px; }
.pdf-party { flex: 1; }
.pdf-plabel { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: #999; margin-bottom: 5px; border-bottom: 1px solid #E5E7EB; padding-bottom: 4px; }
.pdf-pname { font-weight: 700; font-size: 13px; margin-bottom: 2px; }
.pdf-pinfo { color: #555; font-size: 11px; }
.pdf-object { background: #F8F9FB; border: 1px solid #E5E7EB; padding: 9px 12px; margin-bottom: 18px; font-size: 12px; }
.pdf-table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
.pdf-thead tr { background: #1B3A6B; color: #fff; }
.pdf-thead th { padding: 8px 12px; text-align: left; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
.pdf-thead th.r { text-align: right; }
.pdf-tbody td { padding: 10px 12px; border-bottom: 1px solid #E5E7EB; font-size: 12px; }
.pdf-tbody td.r { text-align: right; }
.pdf-totals-wrap { display: flex; justify-content: flex-end; margin-bottom: 16px; }
.pdf-totals { border-collapse: collapse; min-width: 260px; }
.pdf-totals td { padding: 4px 12px; font-size: 11px; color: #555; }
.pdf-totals td.r { text-align: right; }
.pdf-total-row td { padding: 9px 12px; font-weight: 700; font-size: 13px; border-top: 2px solid #1B3A6B; background: #F8F9FB; }
.pdf-total-row td.big { font-size: 18px; font-weight: 700; color: #1B3A6B; text-align: right; }
.pdf-section { margin-top: 20px; border-top: 1px solid #E5E7EB; padding-top: 14px; }
.pdf-sec-title { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: #1B3A6B; margin-bottom: 6px; }
.pdf-sec-text { font-size: 10.5px; color: #444; line-height: 1.8; }
.pdf-sigs { margin-top: 24px; display: flex; gap: 48px; }
.pdf-sig { flex: 1; border-top: 1px solid #999; padding-top: 6px; font-size: 10px; color: #666; }
.pdf-foot { margin-top: 28px; padding-top: 12px; border-top: 1px solid #E5E7EB; display: flex; justify-content: space-between; font-size: 9px; color: #bbb; }

/* TWO-COL */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
/* RECAP */
.recap-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #E5E7EB; font-size: 12px; }
.recap-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
/* RESULT CARD */
.result-card { border: 1px solid #D6DAE4; border-left: 3px solid #1B3A6B; padding: 12px 16px; margin-bottom: 10px; background: #F8F9FB; }

/* ACTIVITY */
.act-item { display: flex; gap: 12px; align-items: flex-start; padding: 9px 0; border-bottom: 1px solid #EEF0F5; }
.act-dot { width: 8px; height: 8px; border-radius: 50%; background: #1B3A6B; flex-shrink: 0; margin-top: 4px; }
.act-text { font-size: 12px; color: #374151; }
.act-time { font-size: 10px; color: #9CA3AF; margin-top: 1px; }

/* INV TOTALS */
.inv-tot-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 12px; margin-bottom: 18px; }
.inv-tot-card { background: #fff; border: 1px solid #D6DAE4; padding: 13px 16px; border-top: 2px solid #D1D5DB; }
.inv-tot-label { font-size: 10px; font-weight: 700; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
.inv-tot-val { font-size: 18px; font-weight: 700; }

/* FIN ITEM */
.fin-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #EEF0F5; }

/* PAGE visibility */
.page { display: none; }
.page.active { display: block; }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-mark">CRG</div>
      <div class="login-divider"></div>
      <div class="login-logo-sub">Internal System</div>
    </div>
    <div class="login-title">Acc√®s S√©curis√©</div>
    <div class="login-sub">R√©serv√© au personnel autoris√© uniquement.</div>
    <div class="login-field">
      <label class="login-label">Adresse e-mail</label>
      <input class="login-input" id="login-email" type="email" placeholder="votre@email.com" autocomplete="username"/>
    </div>
    <div class="login-field">
      <label class="login-label">Mot de passe</label>
      <input class="login-input" id="login-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()"/>
    </div>
    <button class="login-btn" onclick="doLogin()">Connexion</button>
    <div class="login-error" id="login-error">Identifiants incorrects. Acc√®s refus√©.</div>
    <div class="login-footer">CRG Internal &nbsp;¬∑&nbsp; Acc√®s restreint &nbsp;¬∑&nbsp; Usage interne uniquement</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP -->
<div id="app">

  <!-- TOPBAR -->
  <div id="topbar">
    <div class="tb-brand">
      <div>
        <div class="tb-logo">CRG</div>
        <div class="tb-logo-sub">Internal System</div>
      </div>
    </div>
    <nav class="tb-nav">
      <button class="tb-nav-btn active" data-page="dashboard">Tableau de bord</button>
      <button class="tb-nav-btn" data-page="clients">Clients</button>
      <button class="tb-nav-btn" data-page="freelances">Freelances</button>
      <button class="tb-nav-btn" data-page="contracts">Contrats</button>
      <button class="tb-nav-btn" data-page="quotes">Devis</button>
      <button class="tb-nav-btn" data-page="invoices">Factures</button>
      <button class="tb-nav-btn" data-page="automation">Automatisation</button>
      <button class="tb-nav-btn" data-page="finance">Finances</button>
      <button class="tb-nav-btn" data-page="logs">Journal</button>
    </nav>
    <div class="tb-right">
      <button class="tb-late-btn" id="late-pill" style="display:none" onclick="navigate('invoices')">
        ‚ö† <span id="late-pill-txt"></span>
      </button>
      <span class="tb-date" id="tb-date"></span>
      <span class="tb-user">Direction ‚Äî maholo.contact@gmail.com</span>
      <button class="tb-logout" onclick="doLogout()">D√©connexion</button>
    </div>
  </div>

  <div id="content">

    <!-- ‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page active" id="page-dashboard">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Tableau de bord</div>
        <div class="ph-row">
          <div><div class="ph-title">Tableau de bord</div><div class="ph-sub" id="dash-sub"></div></div>
        </div>
      </div>
      <div id="dash-alert" class="alert alert-red" style="display:none"></div>
      <div class="stat-grid" id="dash-stats"></div>
      <div class="two-col">
        <div class="card">
          <div class="card-header">Activit√© r√©cente</div>
          <div class="card-body" id="dash-activity"></div>
        </div>
        <div class="card">
          <div class="card-header">Vue d'ensemble</div>
          <div class="card-body" id="dash-overview"></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê CLIENTS ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-clients">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Clients</div>
        <div class="ph-row">
          <div><div class="ph-title">Gestion des Clients</div><div class="ph-sub" id="clients-sub"></div></div>
          <button class="btn btn-primary" onclick="openModal('modal-new-client')">+ Nouveau client</button>
        </div>
      </div>
      <div class="table-wrap">
        <div class="table-title">R√©pertoire clients</div>
        <table><thead><tr>
          <th>Client</th><th>Contact</th><th>Statut</th><th class="r">Factur√© TTC</th><th class="r">Actions</th>
        </tr></thead><tbody id="clients-tbody"></tbody></table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê FREELANCES ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-freelances">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Freelances</div>
        <div class="ph-row">
          <div><div class="ph-title">Freelances & Prestataires</div><div class="ph-sub" id="freelances-sub"></div></div>
          <button class="btn btn-primary" onclick="openModal('modal-new-freelance')">+ Ajouter un freelance</button>
        </div>
      </div>
      <div class="fl-grid" id="freelances-grid"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê CONTRACTS ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-contracts">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Contrats</div>
        <div class="ph-row">
          <div><div class="ph-title">Gestion des Contrats</div><div class="ph-sub" id="contracts-sub"></div></div>
          <button class="btn btn-primary" onclick="openModal('modal-new-contract')">+ Nouveau contrat</button>
        </div>
      </div>
      <div class="table-wrap">
        <div class="table-title">Registre des contrats</div>
        <table><thead><tr>
          <th>R√©f√©rence</th><th>Type</th><th>Partie</th><th>Objet</th><th class="r">Montant HT</th><th>P√©riode</th><th>Statut</th><th class="r">Actions</th>
        </tr></thead><tbody id="contracts-tbody"></tbody></table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê QUOTES ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-quotes">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Devis</div>
        <div class="ph-row">
          <div><div class="ph-title">Gestion des Devis</div><div class="ph-sub" id="quotes-sub"></div></div>
          <button class="btn btn-primary" onclick="openModal('modal-new-quote')">+ Cr√©er un devis</button>
        </div>
      </div>
      <div class="table-wrap">
        <div class="table-title">Registre des devis</div>
        <table><thead><tr>
          <th>R√©f√©rence</th><th>Client</th><th>Objet</th><th class="r">Montant HT</th><th>Date</th><th>Statut</th><th class="r"></th>
        </tr></thead><tbody id="quotes-tbody"></tbody></table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê INVOICES ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-invoices">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Factures</div>
        <div class="ph-row">
          <div><div class="ph-title">Gestion des Factures</div><div class="ph-sub" id="invoices-sub"></div></div>
          <button class="btn btn-primary" onclick="openModal('modal-new-invoice')">+ Nouvelle facture</button>
        </div>
      </div>
      <div class="inv-tot-grid" id="inv-totals"></div>
      <div class="table-wrap">
        <div class="table-title">Registre des factures</div>
        <table><thead><tr>
          <th>R√©f√©rence</th><th>Client</th><th>Devis li√©</th><th class="r">HT</th><th class="r">TTC</th><th>√âch√©ance</th><th>Statut</th><th class="r">Actions</th>
        </tr></thead><tbody id="invoices-tbody"></tbody></table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê AUTOMATION ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-automation">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Automatisation</div>
        <div class="ph-row"><div><div class="ph-title">G√©n√©ration Automatique de Documents</div><div class="ph-sub">Cr√©ez un pack complet Devis + Contrat + Facture d'acompte en un clic</div></div></div>
      </div>
      <div class="alert alert-blue">
        ‚Ñπ &nbsp; S√©lectionnez un client et saisissez le montant. Le syst√®me g√©n√®re automatiquement un devis au montant total, un contrat en brouillon, et une facture d'acompte √† 30%.
      </div>
      <div class="two-col">
        <div class="card">
          <div class="card-header">Param√®tres du projet</div>
          <div class="card-body">
            <div style="margin-bottom:14px"><label class="form-label">Client b√©n√©ficiaire</label><select class="form-select" id="auto-client" style="margin-top:5px"></select></div>
            <div style="margin-bottom:14px"><label class="form-label">Type de projet</label><select class="form-select" id="auto-type" style="margin-top:5px"><option>Site vitrine</option><option>Application web</option><option>Audit technique</option><option>Refonte compl√®te</option><option>Design & Branding</option><option>Application mobile</option><option>Conseil & Strat√©gie</option></select></div>
            <div style="margin-bottom:14px"><label class="form-label">Description compl√©mentaire (optionnel)</label><textarea class="form-textarea" id="auto-desc" rows="3" style="margin-top:5px" placeholder="Pr√©cisions sur la prestation..."></textarea></div>
            <div style="margin-bottom:14px"><label class="form-label">Montant total HT (‚Ç¨)</label><input class="form-input" id="auto-amount" type="number" style="margin-top:5px" placeholder="15 000" oninput="updateAutoRecap()"/></div>
            <div id="auto-recap" style="display:none;background:#F8F9FB;border:1px solid #D6DAE4;padding:14px;margin-bottom:16px"></div>
            <button class="btn btn-primary btn-lg btn-block" onclick="runAuto()">‚ö° G√©n√©rer le pack complet</button>
          </div>
        </div>
        <div class="card">
          <div class="card-header">R√©sultat</div>
          <div class="card-body" id="auto-result">
            <div class="empty">
              <div class="empty-title">En attente de g√©n√©ration</div>
              <div class="empty-sub">Remplissez le formulaire puis cliquez sur G√©n√©rer</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê FINANCE ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-finance">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Finances</div>
        <div class="ph-row"><div><div class="ph-title">Analyse Financi√®re</div><div class="ph-sub">Consolidation des donn√©es financi√®res</div></div></div>
      </div>
      <div class="two-col" id="finance-content"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê LOGS ‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="page-logs">
      <div class="ph">
        <div class="ph-crumbs">CRG Internal ‚Ä∫ Journal</div>
        <div class="ph-row"><div><div class="ph-title">Journal d'Activit√©</div><div class="ph-sub" id="logs-sub"></div></div></div>
      </div>
      <div class="table-wrap">
        <div class="table-title">Tra√ßabilit√© des op√©rations</div>
        <table><thead><tr><th>#</th><th>Action</th><th>Utilisateur</th><th>Horodatage</th></tr></thead>
        <tbody id="logs-tbody"></tbody></table>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /app -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS -->

<!-- New Client -->
<div class="modal-overlay" id="modal-new-client" style="display:none">
  <div class="modal-box">
    <div class="modal-header">
      <div><div class="modal-title">Cr√©er un client</div><div class="modal-sub">Renseignez les informations du nouveau client</div></div>
      <button class="modal-close" onclick="closeModal('modal-new-client')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label class="form-label">Raison sociale / Nom *</label><input class="form-input" id="c-name" placeholder="Ex : Nexora Technologies" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Email *</label><input class="form-input" id="c-email" type="email" placeholder="contact@client.fr" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">T√©l√©phone</label><input class="form-input" id="c-phone" placeholder="+33 6 00 00 00 00" style="margin-top:5px"/></div>
        <div class="form-group full"><label class="form-label">Adresse</label><input class="form-input" id="c-address" placeholder="Adresse compl√®te" style="margin-top:5px"/></div>
        <div class="form-group full"><label class="form-label">Statut initial</label><select class="form-select" id="c-status" style="margin-top:5px"><option value="prospect">Prospect</option><option value="client">Client actif</option></select></div>
      </div>
      <div class="form-footer"><button class="btn btn-secondary" onclick="closeModal('modal-new-client')">Annuler</button><button class="btn btn-primary" onclick="saveClient()">Cr√©er le client</button></div>
    </div>
  </div>
</div>

<!-- Client Detail -->
<div class="modal-overlay" id="modal-client-detail" style="display:none">
  <div class="modal-box wide">
    <div class="modal-header">
      <div><div class="modal-title" id="detail-client-title"></div><div class="modal-sub">Dossier client complet</div></div>
      <button class="modal-close" onclick="closeModal('modal-client-detail')">‚úï</button>
    </div>
    <div class="modal-body" id="detail-client-body"></div>
  </div>
</div>

<!-- New Freelance -->
<div class="modal-overlay" id="modal-new-freelance" style="display:none">
  <div class="modal-box">
    <div class="modal-header">
      <div><div class="modal-title">Ajouter un freelance</div><div class="modal-sub">Informations du prestataire ind√©pendant</div></div>
      <button class="modal-close" onclick="closeModal('modal-new-freelance')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group"><label class="form-label">Nom complet *</label><input class="form-input" id="fl-name" placeholder="Baptiste Moreau" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Statut</label><select class="form-select" id="fl-status" style="margin-top:5px"><option value="actif">Actif</option><option value="inactif">Inactif</option></select></div>
        <div class="form-group"><label class="form-label">Email *</label><input class="form-input" id="fl-email" type="email" placeholder="contact@freelance.fr" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">N¬∞ SIRET</label><input class="form-input" id="fl-siret" placeholder="84123456700012" style="margin-top:5px"/></div>
        <div class="form-group full"><label class="form-label">Sp√©cialit√©</label><input class="form-input" id="fl-specialty" placeholder="D√©veloppement React / Node.js" style="margin-top:5px"/></div>
        <div class="form-group full"><label class="form-label">Adresse</label><input class="form-input" id="fl-address" placeholder="Adresse compl√®te" style="margin-top:5px"/></div>
      </div>
      <div class="form-footer"><button class="btn btn-secondary" onclick="closeModal('modal-new-freelance')">Annuler</button><button class="btn btn-primary" onclick="saveFreelance()">Ajouter</button></div>
    </div>
  </div>
</div>

<!-- New Contract -->
<div class="modal-overlay" id="modal-new-contract" style="display:none">
  <div class="modal-box wide">
    <div class="modal-header">
      <div><div class="modal-title">Cr√©er un contrat</div><div class="modal-sub">Renseignez les termes du contrat ‚Äî tous les champs appara√Ætront dans le document PDF</div></div>
      <button class="modal-close" onclick="closeModal('modal-new-contract')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group"><label class="form-label">Type de contrat</label><select class="form-select" id="ct-type" onchange="updateContractParty()" style="margin-top:5px"><option value="client">Client</option><option value="freelance">Freelance</option><option value="nda">NDA</option><option value="partenariat">Partenariat</option></select></div>
        <div class="form-group"><label class="form-label">Statut</label><select class="form-select" id="ct-status" style="margin-top:5px"><option value="draft">Brouillon</option><option value="signed">Sign√©</option><option value="completed">Termin√©</option></select></div>
        <div class="form-group full" id="ct-client-wrap"><label class="form-label">Client associ√©</label><select class="form-select" id="ct-client" style="margin-top:5px"></select></div>
        <div class="form-group full" id="ct-freelance-wrap" style="display:none"><label class="form-label">Freelance associ√©</label><select class="form-select" id="ct-freelance" style="margin-top:5px"></select></div>
        <div class="form-group full"><label class="form-label">Objet / Description de la mission *</label><textarea class="form-textarea" id="ct-desc" rows="4" style="margin-top:5px" placeholder="D√©crivez la mission, les livrables, les objectifs..."></textarea></div>
        <div class="form-group full"><label class="form-label">Conditions particuli√®res</label><textarea class="form-textarea" id="ct-conditions" rows="3" style="margin-top:5px" placeholder="Modalit√©s de validation, p√©nalit√©s, d√©lais sp√©cifiques..."></textarea></div>
        <div class="form-group"><label class="form-label">Montant HT (‚Ç¨)</label><input class="form-input" id="ct-amount" type="number" placeholder="0" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Acompte √† la signature (%)</label><input class="form-input" id="ct-acompte" type="number" value="30" placeholder="30" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Date de d√©but</label><input class="form-input" id="ct-start" type="date" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Date de fin</label><input class="form-input" id="ct-end" type="date" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Lieu d'ex√©cution</label><input class="form-input" id="ct-lieu" placeholder="Paris / T√©l√©travail / √Ä d√©finir" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Clause de confidentialit√©</label><select class="form-select" id="ct-nda" style="margin-top:5px"><option value="standard">Standard (incluse)</option><option value="renforcee">Renforc√©e (NDA s√©par√© requis)</option><option value="aucune">Aucune</option></select></div>
      </div>
      <div class="form-footer"><button class="btn btn-secondary" onclick="closeModal('modal-new-contract')">Annuler</button><button class="btn btn-primary" onclick="saveContract()">Cr√©er le contrat</button></div>
    </div>
  </div>
</div>

<!-- New Quote -->
<div class="modal-overlay" id="modal-new-quote" style="display:none">
  <div class="modal-box">
    <div class="modal-header">
      <div><div class="modal-title">Cr√©er un devis</div><div class="modal-sub">Nouveau devis client</div></div>
      <button class="modal-close" onclick="closeModal('modal-new-quote')">‚úï</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:14px"><label class="form-label">Client destinataire *</label><select class="form-select" id="q-client" style="margin-top:5px"></select></div>
      <div style="margin-bottom:14px"><label class="form-label">Description / Objet *</label><textarea class="form-textarea" id="q-desc" rows="3" style="margin-top:5px" placeholder="D√©taillez la prestation..."></textarea></div>
      <div class="form-grid">
        <div class="form-group"><label class="form-label">Montant HT (‚Ç¨) *</label><input class="form-input" id="q-amount" type="number" placeholder="12 000" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Statut</label><select class="form-select" id="q-status" style="margin-top:5px"><option value="draft">Brouillon</option><option value="sent">Envoy√©</option><option value="accepted">Accept√©</option><option value="refused">Refus√©</option></select></div>
      </div>
      <div class="form-footer"><button class="btn btn-secondary" onclick="closeModal('modal-new-quote')">Annuler</button><button class="btn btn-primary" onclick="saveQuote()">Cr√©er le devis</button></div>
    </div>
  </div>
</div>

<!-- New Invoice -->
<div class="modal-overlay" id="modal-new-invoice" style="display:none">
  <div class="modal-box">
    <div class="modal-header">
      <div><div class="modal-title">Cr√©er une facture</div><div class="modal-sub">√âmission d'une nouvelle facture</div></div>
      <button class="modal-close" onclick="closeModal('modal-new-invoice')">‚úï</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:14px"><label class="form-label">Client *</label><select class="form-select" id="inv-client" style="margin-top:5px"></select></div>
      <div style="margin-bottom:14px"><label class="form-label">Devis associ√© (optionnel)</label><select class="form-select" id="inv-quote" style="margin-top:5px"><option value="">Aucun</option></select></div>
      <div class="form-grid">
        <div class="form-group"><label class="form-label">Montant HT (‚Ç¨) *</label><input class="form-input" id="inv-amount" type="number" placeholder="6 000" style="margin-top:5px"/></div>
        <div class="form-group"><label class="form-label">Date d'√©ch√©ance</label><input class="form-input" id="inv-due" type="date" style="margin-top:5px"/></div>
        <div class="form-group full"><label class="form-label">Statut</label><select class="form-select" id="inv-status" style="margin-top:5px"><option value="unpaid">Non pay√©</option><option value="paid">Pay√©</option><option value="late">En retard</option></select></div>
      </div>
      <div class="form-footer"><button class="btn btn-secondary" onclick="closeModal('modal-new-invoice')">Annuler</button><button class="btn btn-primary" onclick="saveInvoice()">√âmettre la facture</button></div>
    </div>
  </div>
</div>

<!-- PDF Preview -->
<div class="modal-overlay" id="modal-pdf" style="display:none">
  <div class="modal-box wide">
    <div class="modal-header">
      <div><div class="modal-title" id="pdf-modal-title">Aper√ßu du document</div></div>
      <button class="modal-close" onclick="closeModal('modal-pdf')">‚úï</button>
    </div>
    <div class="modal-body">
      <div id="pdf-content"></div>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:16px">
        <button class="btn btn-secondary" onclick="closeModal('modal-pdf')">Fermer</button>
        <button class="btn btn-primary" onclick="printPDF()">üñ® Imprimer / Enregistrer PDF</button>
      </div>
    </div>
  </div>
</div>

<div id="toast-container"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH
const CREDS = { email: "maholo.contact@gmail.com", pass: "Maholo_56100" };

function doLogin() {
  const e = document.getElementById("login-email").value.trim().toLowerCase();
  const p = document.getElementById("login-pass").value;
  const err = document.getElementById("login-error");
  if(e === CREDS.email.toLowerCase() && p === CREDS.pass) {
    document.getElementById("login-screen").style.display = "none";
    document.getElementById("app").style.display = "block";
    initApp();
  } else {
    err.style.display = "block";
    document.getElementById("login-pass").value = "";
  }
}
function doLogout() {
  document.getElementById("app").style.display = "none";
  document.getElementById("login-screen").style.display = "flex";
  document.getElementById("login-pass").value = "";
  document.getElementById("login-error").style.display = "none";
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA
let DB = {
  clients: [
    {id:"C001",name:"Nexora Technologies",email:"contact@nexora.io",phone:"+33 6 12 34 56 78",address:"12 Rue de la Paix, 75001 Paris",status:"client",created_at:"2026-01-15"},
    {id:"C002",name:"Studio Lumi√®re",email:"hello@studiolumiere.fr",phone:"+33 6 98 76 54 32",address:"45 Avenue Montaigne, 75008 Paris",status:"prospect",created_at:"2026-02-01"},
    {id:"C003",name:"Arkane Solutions",email:"info@arkane.fr",phone:"+33 1 45 67 89 10",address:"8 Quai du Commerce, 69002 Lyon",status:"client",created_at:"2025-11-20"},
  ],
  freelances: [
    {id:"F001",name:"Baptiste Moreau",email:"baptiste@bmoreau.dev",siret:"84123456700012",address:"22 Rue des Arts, 31000 Toulouse",specialty:"D√©veloppement React / Node.js",status:"actif",created_at:"2026-01-10"},
    {id:"F002",name:"Clara Voss",email:"clara@claravoss.design",siret:"79876543200034",address:"5 Impasse des Lilas, 13001 Marseille",specialty:"UI/UX Design & Motion",status:"actif",created_at:"2025-12-05"},
    {id:"F003",name:"Mehdi Sa√Ød",email:"mehdi@said-dev.fr",siret:"92345678900056",address:"17 Boulevard Haussmann, 75009 Paris",specialty:"DevOps & Infrastructure",status:"inactif",created_at:"2025-10-15"},
  ],
  contracts: [
    {id:"CT001",type:"freelance",number:"CTR-2026-001",client_id:null,freelance_id:"F001",mission_description:"D√©veloppement application React Dashboard",conditions:"R√©union de suivi hebdomadaire. Livrables valid√©s par sprint.",acompte:30,lieu:"T√©l√©travail",nda:"standard",amount:8500,start_date:"2026-01-20",end_date:"2026-03-20",status:"signed",created_at:"2026-01-18"},
    {id:"CT002",type:"client",number:"CTR-2026-002",client_id:"C001",freelance_id:null,mission_description:"Refonte compl√®te plateforme SaaS ‚Äî Nexora v2",conditions:"Acompte 30% √† la signature. Solde √† la livraison.",acompte:30,lieu:"Paris + T√©l√©travail",nda:"renforcee",amount:18500,start_date:"2026-02-01",end_date:"2026-05-31",status:"signed",created_at:"2026-01-28"},
    {id:"CT003",type:"nda",number:"CTR-2026-003",client_id:"C003",freelance_id:null,mission_description:"Accord de confidentialit√© ‚Äî Projet Arkane X",conditions:"Dur√©e de confidentialit√© : 5 ans apr√®s la fin du contrat.",acompte:0,lieu:"Lyon",nda:"renforcee",amount:0,start_date:"2026-01-15",end_date:"2027-01-15",status:"signed",created_at:"2026-01-14"},
  ],
  quotes: [
    {id:"Q001",number:"DEV-2026-001",client_id:"C001",description:"D√©veloppement Dashboard Analytics + int√©gration Stripe",amount:12000,status:"accepted",created_at:"2026-01-10"},
    {id:"Q002",number:"DEV-2026-002",client_id:"C002",description:"Cr√©ation identit√© visuelle + site vitrine 5 pages",amount:4800,status:"sent",created_at:"2026-02-05"},
    {id:"Q003",number:"DEV-2026-003",client_id:"C003",description:"Audit technique infrastructure cloud + recommandations",amount:6500,status:"draft",created_at:"2026-02-10"},
  ],
  invoices: [
    {id:"I001",number:"FAC-2026-001",client_id:"C001",related_quote_id:"Q001",amount:6000,status:"paid",due_date:"2026-02-10",created_at:"2026-01-20"},
    {id:"I002",number:"FAC-2026-002",client_id:"C001",related_quote_id:"Q001",amount:6000,status:"unpaid",due_date:"2026-03-10",created_at:"2026-02-10"},
    {id:"I003",number:"FAC-2026-003",client_id:"C003",related_quote_id:null,amount:32000,status:"paid",due_date:"2026-01-31",created_at:"2026-01-15"},
    {id:"I004",number:"FAC-2026-004",client_id:"C002",related_quote_id:"Q002",amount:4800,status:"late",due_date:"2026-02-01",created_at:"2026-01-15"},
  ],
  missions: [
    {id:"M001",freelance_id:"F001",contract_id:"CT001",description:"Sprint 1 ‚Äî Architecture & Setup",amount:2500,status:"completed",created_at:"2026-01-20"},
    {id:"M002",freelance_id:"F001",contract_id:"CT001",description:"Sprint 2 ‚Äî Core features",amount:3500,status:"in_progress",created_at:"2026-02-05"},
    {id:"M003",freelance_id:"F002",contract_id:null,description:"Maquettes Figma ‚Äî Studio Lumi√®re",amount:1800,status:"completed",created_at:"2026-01-28"},
  ],
  logs: [
    {id:"L001",action:"Contrat CTR-2026-001 sign√©",user:"Direction",timestamp:"2026-01-18 14:32"},
    {id:"L002",action:"Facture FAC-2026-001 marqu√©e pay√©e",user:"Direction",timestamp:"2026-02-11 09:15"},
    {id:"L003",action:"Nouveau client cr√©√© : Studio Lumi√®re",user:"Direction",timestamp:"2026-02-01 16:44"},
    {id:"L004",action:"Devis DEV-2026-002 envoy√©",user:"Direction",timestamp:"2026-02-05 11:20"},
  ],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HELPERS
const uid = () => Math.random().toString(36).substr(2,9).toUpperCase();
const today = () => new Date().toISOString().split("T")[0];
const fmt = n => Number(n).toLocaleString("fr-FR",{minimumFractionDigits:2});
const fmtDate = d => d ? new Date(d+"T12:00:00").toLocaleDateString("fr-FR") : "‚Äî";
const esc = s => (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
const genNum = (prefix, list) => {
  const y = new Date().getFullYear();
  const n = list.filter(i=>i.number?.startsWith(`${prefix}-${y}`)).length + 1;
  return `${prefix}-${y}-${String(n).padStart(3,"0")}`;
};

const STAT_CFG = {
  client:{l:"Client",c:"badge-green"},prospect:{l:"Prospect",c:"badge-amber"},
  actif:{l:"Actif",c:"badge-green"},inactif:{l:"Inactif",c:"badge-gray"},
  draft:{l:"Brouillon",c:"badge-gray"},signed:{l:"Sign√©",c:"badge-green"},
  completed:{l:"Termin√©",c:"badge-purple"},sent:{l:"Envoy√©",c:"badge-blue"},
  accepted:{l:"Accept√©",c:"badge-green"},refused:{l:"Refus√©",c:"badge-red"},
  unpaid:{l:"Non pay√©",c:"badge-amber"},paid:{l:"Pay√©",c:"badge-green"},
  late:{l:"En retard",c:"badge-red"},in_progress:{l:"En cours",c:"badge-blue"},
};
const badge = s => { const c=STAT_CFG[s]||{l:s,c:"badge-gray"}; return `<span class="badge ${c.c}">${esc(c.l)}</span>`; };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT
function initApp() {
  document.getElementById("tb-date").textContent = new Date().toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"});
  document.querySelectorAll(".tb-nav-btn").forEach(btn => btn.addEventListener("click", () => navigate(btn.dataset.page)));
  document.querySelectorAll(".modal-overlay").forEach(o => o.addEventListener("click", e => { if(e.target===o) o.style.display="none"; }));
  navigate("dashboard");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVIGATION
function navigate(page) {
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.querySelectorAll(".tb-nav-btn").forEach(b=>b.classList.remove("active"));
  document.getElementById("page-"+page)?.classList.add("active");
  document.querySelector(`.tb-nav-btn[data-page="${page}"]`)?.classList.add("active");
  renderPage(page); updateBadges();
}
function renderPage(p) {
  if(p==="dashboard") renderDash();
  else if(p==="clients") renderClients();
  else if(p==="freelances") renderFreelances();
  else if(p==="contracts") renderContracts();
  else if(p==="quotes") renderQuotes();
  else if(p==="invoices") renderInvoices();
  else if(p==="automation") renderAuto();
  else if(p==="finance") renderFinance();
  else if(p==="logs") renderLogs();
}
function updateBadges() {
  const lc = DB.invoices.filter(i=>i.status==="late").length;
  const pill = document.getElementById("late-pill");
  if(lc>0){ pill.style.display="flex"; document.getElementById("late-pill-txt").textContent=`${lc} facture${lc>1?"s":""} en retard`; }
  else pill.style.display="none";
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD
function renderDash() {
  document.getElementById("dash-sub").textContent = new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
  const paid=DB.invoices.filter(i=>i.status==="paid").reduce((s,i)=>s+i.amount,0);
  const pending=DB.invoices.filter(i=>i.status==="unpaid").reduce((s,i)=>s+i.amount,0);
  const late=DB.invoices.filter(i=>i.status==="late").reduce((s,i)=>s+i.amount,0);
  const total=DB.invoices.reduce((s,i)=>s+i.amount,0);
  const fcost=DB.missions.reduce((s,m)=>s+m.amount,0);
  const lc=DB.invoices.filter(i=>i.status==="late").length;
  const al=document.getElementById("dash-alert");
  if(lc>0){al.style.display="flex";al.innerHTML=`‚ö† &nbsp;${lc} facture(s) en retard de paiement ‚Äî Action requise`;}else al.style.display="none";
  document.getElementById("dash-stats").innerHTML=[
    {l:"Chiffre d'affaires total",v:`${fmt(total)} ‚Ç¨`,s:`${DB.invoices.length} factures √©mises`,color:"#1B3A6B"},
    {l:"Total encaiss√©",v:`${fmt(paid)} ‚Ç¨`,s:`Taux : ${total?Math.round(paid/total*100):0}%`,color:"#047857"},
    {l:"En attente de r√®glement",v:`${fmt(pending)} ‚Ç¨`,s:"√Ä recevoir",color:"#B45309"},
    {l:"Factures en retard",v:`${fmt(late)} ‚Ç¨`,s:`${lc} facture(s) impay√©e(s)`,color:"#B91C1C"},
    {l:"Co√ªts prestataires",v:`${fmt(fcost)} ‚Ç¨`,s:`${DB.missions.length} missions`,color:"#6D28D9"},
    {l:"B√©n√©fice brut estim√©",v:`${fmt(paid-fcost)} ‚Ç¨`,s:"Encaiss√© moins co√ªts",color:"#1B3A6B"},
  ].map(s=>`<div class="stat-card" style="border-left-color:${s.color}"><div class="stat-label">${s.l}</div><div class="stat-value" style="color:${s.color}">${s.v}</div><div class="stat-sub">${s.s}</div></div>`).join("");

  document.getElementById("dash-activity").innerHTML = [...DB.logs].reverse().slice(0,6).map(l=>`
    <div class="act-item"><div class="act-dot"></div><div><div class="act-text">${esc(l.action)}</div><div class="act-time">${esc(l.timestamp)}</div></div></div>`).join("");

  document.getElementById("dash-overview").innerHTML = [
    {l:"Clients actifs",v:DB.clients.filter(c=>c.status==="client").length,t:DB.clients.length,c:"#1B3A6B"},
    {l:"Freelances actifs",v:DB.freelances.filter(f=>f.status==="actif").length,t:DB.freelances.length,c:"#6D28D9"},
    {l:"Contrats sign√©s",v:DB.contracts.filter(c=>c.status==="signed").length,t:DB.contracts.length,c:"#047857"},
    {l:"Devis accept√©s",v:DB.quotes.filter(q=>q.status==="accepted").length,t:DB.quotes.length,c:"#B45309"},
    {l:"Factures pay√©es",v:DB.invoices.filter(i=>i.status==="paid").length,t:DB.invoices.length,c:"#047857"},
  ].map(item=>`<div style="margin-bottom:14px">
    <div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:12px;color:#374151">${item.l}</span><span style="font-size:12px;font-weight:700;color:#1A1A2E">${item.v} / ${item.t}</span></div>
    <div class="progress"><div class="progress-fill" style="width:${item.t?item.v/item.t*100:0}%;background:${item.c}"></div></div>
  </div>`).join("");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLIENTS
function renderClients() {
  document.getElementById("clients-sub").textContent = `${DB.clients.length} clients ‚Äî ${DB.clients.filter(c=>c.status==="client").length} actifs`;
  const tbody=document.getElementById("clients-tbody");
  if(!DB.clients.length){tbody.innerHTML=`<tr><td colspan="5"><div class="empty"><div class="empty-title">Aucun client enregistr√©</div></div></td></tr>`;return;}
  tbody.innerHTML=DB.clients.map(c=>{
    const invs=DB.invoices.filter(i=>i.client_id===c.id);
    const tot=invs.reduce((s,i)=>s+i.amount*1.2,0);
    return `<tr>
      <td><div style="font-size:13px;font-weight:700;color:#1A1A2E">${esc(c.name)}</div><div style="font-size:11px;color:#9CA3AF">${esc(c.address)}</div></td>
      <td><div style="font-size:12px">${esc(c.email)}</div><div style="font-size:11px;color:#9CA3AF">${esc(c.phone)}</div></td>
      <td>${badge(c.status)}</td>
      <td class="r"><span style="font-size:13px;font-weight:700;color:#1A1A2E">${fmt(tot)} ‚Ç¨</span></td>
      <td class="r"><div style="display:flex;gap:6px;justify-content:flex-end">
        <button class="btn btn-secondary" style="font-size:10px;padding:5px 10px" onclick="showClientDetail('${c.id}')">Dossier</button>
        <button class="btn btn-danger" style="font-size:10px;padding:5px 10px" onclick="deleteClient('${c.id}')">Suppr.</button>
      </div></td>
    </tr>`;
  }).join("");
}
function showClientDetail(id) {
  const c=DB.clients.find(x=>x.id===id); if(!c)return;
  const invs=DB.invoices.filter(i=>i.client_id===id);
  const ctrs=DB.contracts.filter(ct=>ct.client_id===id);
  const qts=DB.quotes.filter(q=>q.client_id===id);
  document.getElementById("detail-client-title").textContent=c.name;
  document.getElementById("detail-client-body").innerHTML=`
    <div class="two-col" style="margin-bottom:20px">
      <div style="background:#F8F9FB;border:1px solid #D6DAE4;padding:16px">
        <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:#6B7280;margin-bottom:10px;border-bottom:1px solid #E5E7EB;padding-bottom:6px">Coordonn√©es</div>
        ${[["Email",c.email],["T√©l√©phone",c.phone],["Adresse",c.address],["Client depuis",fmtDate(c.created_at)]].map(([k,v])=>`
        <div style="display:flex;gap:10px;margin-bottom:8px;font-size:12px"><span style="color:#6B7280;min-width:90px;flex-shrink:0">${k}</span><span style="color:#1A1A2E;font-weight:600">${esc(v)}</span></div>`).join("")}
        <div style="margin-top:8px">${badge(c.status)}</div>
      </div>
      <div style="background:#F8F9FB;border:1px solid #D6DAE4;padding:16px">
        <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:#6B7280;margin-bottom:10px;border-bottom:1px solid #E5E7EB;padding-bottom:6px">R√©sum√© financier</div>
        ${[["Factures √©mises",invs.length],["Total factur√© HT",fmt(invs.reduce((s,i)=>s+i.amount,0))+" ‚Ç¨"],["Total encaiss√© HT",fmt(invs.filter(i=>i.status==="paid").reduce((s,i)=>s+i.amount,0))+" ‚Ç¨"],["Contrats",ctrs.length],["Devis",qts.length]].map(([k,v])=>`
        <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #E5E7EB;font-size:12px"><span style="color:#6B7280">${k}</span><span style="font-weight:700;color:#1A1A2E">${v}</span></div>`).join("")}
      </div>
    </div>
    ${invs.length>0?`<div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:#6B7280;margin-bottom:10px">Historique des factures</div>
    ${invs.map(inv=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:#F8F9FB;border:1px solid #D6DAE4;margin-bottom:6px">
      <span class="mono">${esc(inv.number)}</span>
      <span style="font-size:13px;font-weight:700;color:#1A1A2E">${fmt(inv.amount)} ‚Ç¨</span>
      <span style="font-size:11px;color:#9CA3AF">√âch. ${fmtDate(inv.due_date)}</span>
      ${badge(inv.status)}
    </div>`).join("")}`:""}
  `;
  openModal("modal-client-detail");
}
function deleteClient(id) {
  if(DB.invoices.some(i=>i.client_id===id)||DB.contracts.some(c=>c.client_id===id))
    return showToast("Impossible : documents li√©s √† ce client","error");
  DB.clients=DB.clients.filter(c=>c.id!==id);
  showToast("Client supprim√©"); renderClients();
}
function saveClient() {
  const name=document.getElementById("c-name").value.trim();
  const email=document.getElementById("c-email").value.trim();
  if(!name||!email) return showToast("Nom et email requis","error");
  DB.clients.push({id:uid(),name,email,phone:document.getElementById("c-phone").value.trim(),address:document.getElementById("c-address").value.trim(),status:document.getElementById("c-status").value,created_at:today()});
  DB.logs.push({id:uid(),action:`Client cr√©√© : ${name}`,user:"Direction",timestamp:new Date().toLocaleString("fr-FR")});
  closeModal("modal-new-client");
  ["c-name","c-email","c-phone","c-address"].forEach(i=>document.getElementById(i).value="");
  showToast("Client cr√©√© avec succ√®s"); renderClients();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FREELANCES
function renderFreelances() {
  document.getElementById("freelances-sub").textContent=`${DB.freelances.filter(f=>f.status==="actif").length} actifs sur ${DB.freelances.length} enregistr√©s`;
  document.getElementById("freelances-grid").innerHTML=DB.freelances.map(f=>{
    const m=DB.missions.filter(x=>x.freelance_id===f.id);
    const earn=m.reduce((s,x)=>s+x.amount,0);
    const ini=f.name.split(" ").map(n=>n[0]).join("");
    return `<div class="fl-card">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;padding-bottom:14px;border-bottom:1px solid #D6DAE4">
        <div class="fl-initials">${esc(ini)}</div>
        <div><div class="fl-name">${esc(f.name)}</div><div class="fl-spec">${esc(f.specialty)}</div></div>
      </div>
      ${badge(f.status)}
      <div style="margin-top:12px">
        ${[["Email",f.email],["SIRET",f.siret],["Adresse",f.address]].map(([k,v])=>`
        <div class="fl-row"><span style="color:#6B7280">${k}</span><span style="color:#374151;font-weight:600;text-align:right;max-width:160px;overflow:hidden;text-overflow:ellipsis">${esc(v)}</span></div>`).join("")}
      </div>
      <div class="fl-earn">
        <div><div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:#6B7280">Total vers√©</div><div style="font-size:11px;color:#9CA3AF;margin-top:1px">${m.length} mission(s)</div></div>
        <div style="font-size:18px;font-weight:700;color:#1B3A6B">${fmt(earn)} ‚Ç¨</div>
      </div>
    </div>`;
  }).join("");
}
function saveFreelance() {
  const name=document.getElementById("fl-name").value.trim();
  const email=document.getElementById("fl-email").value.trim();
  if(!name||!email) return showToast("Nom et email requis","error");
  DB.freelances.push({id:uid(),name,email,siret:document.getElementById("fl-siret").value.trim(),address:document.getElementById("fl-address").value.trim(),specialty:document.getElementById("fl-specialty").value.trim(),status:document.getElementById("fl-status").value,created_at:today()});
  DB.logs.push({id:uid(),action:`Freelance ajout√© : ${name}`,user:"Direction",timestamp:new Date().toLocaleString("fr-FR")});
  closeModal("modal-new-freelance");
  ["fl-name","fl-email","fl-siret","fl-address","fl-specialty"].forEach(i=>document.getElementById(i).value="");
  showToast("Freelance ajout√©"); renderFreelances();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTRACTS
function renderContracts() {
  document.getElementById("contracts-sub").textContent=`${DB.contracts.length} contrats ‚Äî ${DB.contracts.filter(c=>c.status==="signed").length} sign√©s`;
  const TYPES={client:"Client",freelance:"Freelance",nda:"NDA",partenariat:"Partenariat"};
  const tbody=document.getElementById("contracts-tbody");
  if(!DB.contracts.length){tbody.innerHTML=`<tr><td colspan="8"><div class="empty"><div class="empty-title">Aucun contrat</div></div></td></tr>`;return;}
  tbody.innerHTML=DB.contracts.map(c=>{
    const party=c.client_id?DB.clients.find(x=>x.id===c.client_id)?.name||"‚Äî":c.freelance_id?DB.freelances.find(x=>x.id===c.freelance_id)?.name||"‚Äî":"‚Äî";
    return `<tr>
      <td><span class="mono">${esc(c.number)}</span></td>
      <td><span style="font-size:10px;font-weight:700;background:#E8EDF5;color:#1B3A6B;padding:2px 8px;border:1px solid #C5CEDF">${esc(TYPES[c.type]||c.type)}</span></td>
      <td style="font-size:12px;color:#374151">${esc(party)}</td>
      <td><span style="font-size:11px;color:#6B7280;max-width:200px;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(c.mission_description)}</span></td>
      <td class="r"><span style="font-size:12px;font-weight:700;color:#1A1A2E">${c.amount>0?fmt(c.amount)+" ‚Ç¨":"‚Äî"}</span></td>
      <td><div style="font-size:11px;color:#9CA3AF">${fmtDate(c.start_date)}<br>${fmtDate(c.end_date)}</div></td>
      <td>${badge(c.status)}</td>
      <td class="r"><button class="btn btn-secondary" style="font-size:10px;padding:5px 10px" onclick="showPDF('contract','${c.id}')">Aper√ßu PDF</button></td>
    </tr>`;
  }).join("");
}
function updateContractParty() {
  const t=document.getElementById("ct-type").value;
  document.getElementById("ct-client-wrap").style.display=t==="freelance"?"none":"";
  document.getElementById("ct-freelance-wrap").style.display=t==="freelance"?"":"none";
}
function saveContract() {
  const desc=document.getElementById("ct-desc").value.trim();
  if(!desc) return showToast("La description est requise","error");
  const num=genNum("CTR",DB.contracts);
  const type=document.getElementById("ct-type").value;
  DB.contracts.push({id:uid(),type,number:num,created_at:today(),
    client_id:type!=="freelance"?(document.getElementById("ct-client").value||null):null,
    freelance_id:type==="freelance"?(document.getElementById("ct-freelance").value||null):null,
    mission_description:desc,
    conditions:document.getElementById("ct-conditions").value.trim(),
    acompte:Number(document.getElementById("ct-acompte").value)||30,
    lieu:document.getElementById("ct-lieu").value.trim(),
    nda:document.getElementById("ct-nda").value,
    amount:Number(document.getElementById("ct-amount").value)||0,
    start_date:document.getElementById("ct-start").value,
    end_date:document.getElementById("ct-end").value,
    status:document.getElementById("ct-status").value,
  });
  DB.logs.push({id:uid(),action:`Contrat ${num} cr√©√©`,user:"Direction",timestamp:new Date().toLocaleString("fr-FR")});
  closeModal("modal-new-contract");
  showToast(`Contrat ${num} cr√©√©`); renderContracts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUOTES
function renderQuotes() {
  document.getElementById("quotes-sub").textContent=`${DB.quotes.filter(q=>q.status==="accepted").length} accept√©s ‚Äî ${DB.quotes.filter(q=>q.status==="sent").length} en attente`;
  document.getElementById("quotes-tbody").innerHTML=DB.quotes.map(q=>{
    const client=DB.clients.find(c=>c.id===q.client_id);
    return `<tr>
      <td><span class="mono">${esc(q.number)}</span></td>
      <td style="font-size:12px">${esc(client?.name||"‚Äî")}</td>
      <td><span style="font-size:11px;color:#6B7280;max-width:220px;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(q.description)}</span></td>
      <td class="r"><span style="font-size:12px;font-weight:700;color:#1A1A2E">${fmt(q.amount)} ‚Ç¨</span></td>
      <td style="font-size:11px;color:#9CA3AF">${fmtDate(q.created_at)}</td>
      <td>${badge(q.status)}</td>
      <td class="r"><button class="btn btn-secondary" style="font-size:10px;padding:5px 10px" onclick="showPDF('quote','${q.id}')">PDF</button></td>
    </tr>`;
  }).join("");
}
function saveQuote() {
  const cid=document.getElementById("q-client").value;
  const desc=document.getElementById("q-desc").value.trim();
  const amount=document.getElementById("q-amount").value;
  if(!cid||!desc||!amount) return showToast("Tous les champs sont requis","error");
  const num=genNum("DEV",DB.quotes);
  DB.quotes.push({id:uid(),number:num,client_id:cid,description:desc,amount:Number(amount),status:document.getElementById("q-status").value,created_at:today()});
  DB.logs.push({id:uid(),action:`Devis ${num} cr√©√©`,user:"Direction",timestamp:new Date().toLocaleString("fr-FR")});
  closeModal("modal-new-quote");
  ["q-desc","q-amount"].forEach(i=>document.getElementById(i).value="");
  showToast(`Devis ${num} cr√©√©`); renderQuotes();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INVOICES
function renderInvoices() {
  const lc=DB.invoices.filter(i=>i.status==="late").length;
  document.getElementById("invoices-sub").textContent=`${DB.invoices.length} factures ‚Äî ${lc} en retard`;
  const total=DB.invoices.reduce((s,i)=>s+i.amount,0);
  const paid=DB.invoices.filter(i=>i.status==="paid").reduce((s,i)=>s+i.amount,0);
  const unpaid=DB.invoices.filter(i=>i.status==="unpaid").reduce((s,i)=>s+i.amount,0);
  const lateAmt=DB.invoices.filter(i=>i.status==="late").reduce((s,i)=>s+i.amount,0);
  document.getElementById("inv-totals").innerHTML=[
    {l:"Total √©mis HT",v:total,c:"#1B3A6B",b:"#1B3A6B"},
    {l:"Encaiss√© HT",v:paid,c:"#047857",b:"#047857"},
    {l:"En attente HT",v:unpaid,c:"#B45309",b:"#B45309"},
    {l:"En retard HT",v:lateAmt,c:"#B91C1C",b:"#B91C1C"},
  ].map(s=>`<div class="inv-tot-card" style="border-top-color:${s.b}"><div class="inv-tot-label">${s.l}</div><div class="inv-tot-val" style="color:${s.c}">${fmt(s.v)} ‚Ç¨</div></div>`).join("");
  document.getElementById("invoices-tbody").innerHTML=DB.invoices.map(inv=>{
    const client=DB.clients.find(c=>c.id===inv.client_id);
    const q=inv.related_quote_id?DB.quotes.find(x=>x.id===inv.related_quote_id):null;
    return `<tr>
      <td><span class="mono">${esc(inv.number)}</span></td>
      <td style="font-size:12px">${esc(client?.name||"‚Äî")}</td>
      <td><span style="font-family:'Courier New',monospace;font-size:11px;color:#9CA3AF">${esc(q?.number||"‚Äî")}</span></td>
      <td class="r" style="font-size:12px">${fmt(inv.amount)} ‚Ç¨</td>
      <td class="r"><span style="font-size:12px;font-weight:700;color:#1A1A2E">${fmt(inv.amount*1.2)} ‚Ç¨</span></td>
      <td><span style="font-size:11px;color:${inv.status==="late"?"#B91C1C":"#9CA3AF"};font-weight:${inv.status==="late"?700:400}">${fmtDate(inv.due_date)}</span></td>
      <td>${badge(inv.status)}</td>
      <td class="r"><div style="display:flex;gap:6px;justify-content:flex-end">
        <button class="btn btn-secondary" style="font-size:10px;padding:5px 10px" onclick="showPDF('invoice','${inv.id}')">PDF</button>
        ${inv.status!=="paid"?`<button class="btn btn-success" style="font-size:10px;padding:5px 10px" onclick="markPaid('${inv.id}')">‚úì Payer</button>`:""}
      </div></td>
    </tr>`;
  }).join("");
}
function markPaid(id) {
  const inv=DB.invoices.find(i=>i.id===id); if(!inv)return;
  inv.status="paid";
  DB.logs.push({id:uid(),action:`Facture ${inv.number} marqu√©e pay√©e`,user:"Direction",timestamp:new Date().toLocaleString("fr-FR")});
  showToast(`Facture ${inv.number} pay√©e`); renderInvoices(); updateBadges();
}
function saveInvoice() {
  const cid=document.getElementById("inv-client").value;
  const amount=document.getElementById("inv-amount").value;
  if(!cid||!amount) return showToast("Client et montant requis","error");
  const num=genNum("FAC",DB.invoices);
  DB.invoices.push({id:uid(),number:num,client_id:cid,related_quote_id:document.getElementById("inv-quote").value||null,amount:Number(amount),status:document.getElementById("inv-status").value,due_date:document.getElementById("inv-due").value,created_at:today()});
  DB.logs.push({id:uid(),action:`Facture ${num} cr√©√©e`,user:"Direction",timestamp:new Date().toLocaleString("fr-FR")});
  closeModal("modal-new-invoice");
  ["inv-amount","inv-due"].forEach(i=>document.getElementById(i).value="");
  showToast(`Facture ${num} cr√©√©e`); renderInvoices(); updateBadges();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTOMATION
function renderAuto() {
  document.getElementById("auto-client").innerHTML='<option value="">‚Äî S√©lectionner un client ‚Äî</option>'+DB.clients.map(c=>`<option value="${c.id}">${esc(c.name)}</option>`).join("");
}
function updateAutoRecap() {
  const amount=Number(document.getElementById("auto-amount").value);
  const recap=document.getElementById("auto-recap");
  if(amount>0){
    recap.style.display="block";
    recap.innerHTML=`<div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:#6B7280;margin-bottom:10px">Documents √† g√©n√©rer</div>`+
      [{l:"Devis",d:`${fmt(amount)} ‚Ç¨ HT`,c:"#1B3A6B"},{l:"Contrat (brouillon)",d:"√Ä compl√©ter et signer",c:"#B45309"},{l:"Facture acompte 30%",d:`${fmt(Math.round(amount*0.3))} ‚Ç¨ HT`,c:"#047857"}].map(item=>`
      <div class="recap-item"><div class="recap-dot" style="background:${item.c}"></div><span style="flex:1">${item.l}</span><span style="font-weight:700;color:${item.c}">${item.d}</span></div>`).join("");
  } else recap.style.display="none";
}
function runAuto() {
  const cid=document.getElementById("auto-client").value;
  const amount=Number(document.getElementById("auto-amount").value);
  if(!cid||!amount) return showToast("Client et montant requis","error");
  const client=DB.clients.find(c=>c.id===cid);
  const type=document.getElementById("auto-type").value;
  const desc=document.getElementById("auto-desc").value.trim()||`${type} ‚Äî ${client.name}`;
  const ac=Math.round(amount*0.3);
  const qn=genNum("DEV",DB.quotes),fn=genNum("FAC",DB.invoices),cn=genNum("CTR",DB.contracts);
  const quote={id:uid(),number:qn,client_id:cid,description:desc,amount,status:"sent",created_at:today()};
  const invoice={id:uid(),number:fn,client_id:cid,related_quote_id:quote.id,amount:ac,status:"unpaid",due_date:new Date(Date.now()+7*86400000).toISOString().split("T")[0],created_at:today()};
  const contract={id:uid(),type:"client",number:cn,client_id:cid,freelance_id:null,mission_description:desc,conditions:"Acompte 30% √† la signature. Solde √† la livraison finale.",acompte:30,lieu:"√Ä d√©finir",nda:"standard",amount,start_date:today(),end_date:"",status:"draft",created_at:today()};
  DB.quotes.push(quote);DB.invoices.push(invoice);DB.contracts.push(contract);
  ["[AUTO] Devis "+qn+" g√©n√©r√©","[AUTO] Contrat "+cn+" g√©n√©r√©","[AUTO] Facture acompte "+fn+" g√©n√©r√©e"].forEach(a=>DB.logs.push({id:uid(),action:a,user:"Direction",timestamp:new Date().toLocaleString("fr-FR")}));
  document.getElementById("auto-result").innerHTML=`
    <div class="alert alert-blue" style="margin-bottom:14px">‚úì &nbsp;Pack g√©n√©r√© avec succ√®s pour <strong>${esc(client.name)}</strong></div>
    ${[{l:"Devis cr√©√©",item:quote,c:"#1B3A6B"},{l:"Contrat cr√©√©",item:contract,c:"#B45309"},{l:"Facture d'acompte",item:invoice,c:"#047857"}].map(({l,item,c})=>`
    <div class="result-card" style="border-left-color:${c}">
      <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:#6B7280;margin-bottom:4px">${l}</div>
      <div style="font-family:'Courier New',monospace;font-size:14px;font-weight:700;color:${c};margin-bottom:4px">${esc(item.number)}</div>
      <div style="display:flex;align-items:center;justify-content:space-between"><span style="font-size:11px;color:#9CA3AF">${fmt(item.amount)} ‚Ç¨ HT</span>${badge(item.status)}</div>
    </div>`).join("")}
    <div style="font-size:11px;color:#6B7280;background:#F8F9FB;border:1px solid #D6DAE4;padding:10px 12px;margin-top:4px">Tous les documents sont accessibles dans leurs modules respectifs.</div>`;
  showToast("Pack complet g√©n√©r√© !"); updateBadges();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FINANCE
function renderFinance() {
  const total=DB.invoices.reduce((s,i)=>s+i.amount,0);
  const byClient=DB.clients.map(c=>({c,t:DB.invoices.filter(i=>i.client_id===c.id).reduce((s,i)=>s+i.amount,0),p:DB.invoices.filter(i=>i.client_id===c.id&&i.status==="paid").reduce((s,i)=>s+i.amount,0)})).filter(x=>x.t>0).sort((a,b)=>b.t-a.t);
  const mx=Math.max(...byClient.map(x=>x.t),1);
  document.getElementById("finance-content").innerHTML=`
    <div class="card">
      <div class="card-header">Chiffre d'affaires par client</div>
      <div class="card-body">${byClient.map(({c,t,p})=>`
        <div style="margin-bottom:18px">
          <div style="display:flex;justify-content:space-between;margin-bottom:5px">
            <div><div style="font-size:12px;font-weight:700;color:#1A1A2E">${esc(c.name)}</div><div style="font-size:11px;color:#9CA3AF">Encaiss√© : ${fmt(p)} ‚Ç¨ ‚Äî Restant : ${fmt(t-p)} ‚Ç¨</div></div>
            <div style="font-size:14px;font-weight:700;color:#1B3A6B">${fmt(t)} ‚Ç¨</div>
          </div>
          <div class="progress"><div class="progress-fill" style="width:${t/mx*100}%;background:#1B3A6B"></div></div>
          <div class="progress" style="margin-top:3px"><div class="progress-fill" style="width:${t?p/t*100:0}%;background:#047857"></div></div>
          <div style="display:flex;gap:12px;margin-top:3px;font-size:10px;color:#9CA3AF"><span style="color:#1B3A6B">‚ñ¨ Factur√©</span><span style="color:#047857">‚ñ¨ Encaiss√©</span></div>
        </div>`).join("")}
      </div>
    </div>
    <div>
      <div class="card" style="margin-bottom:16px">
        <div class="card-header">R√©partition des r√®glements</div>
        <div class="card-body">${[{l:"Factures pay√©es",s:"paid",c:"#047857"},{l:"En attente",s:"unpaid",c:"#B45309"},{l:"En retard",s:"late",c:"#B91C1C"}].map(x=>{
          const items=DB.invoices.filter(i=>i.status===x.s);
          const sum=items.reduce((t,i)=>t+i.amount,0);
          return `<div class="fin-item">
            <div style="width:36px;height:36px;background:${x.c}15;border:1px solid ${x.c}30;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px">‚Ç¨</div>
            <div style="flex:1"><div style="display:flex;justify-content:space-between"><span style="font-size:12px;font-weight:700;color:#374151">${x.l}</span><span style="font-size:14px;font-weight:700;color:${x.c}">${fmt(sum)} ‚Ç¨</span></div>
            <div style="font-size:11px;color:#9CA3AF">${items.length} facture(s) ‚Äî ${total?Math.round(sum/total*100):0}%</div>
            <div class="progress" style="margin-top:4px"><div class="progress-fill" style="width:${total?sum/total*100:0}%;background:${x.c}"></div></div></div>
          </div>`;}).join("")}
          <div style="margin-top:14px;background:#F8F9FB;border:1px solid #D6DAE4;padding:14px;display:flex;justify-content:space-between;align-items:center">
            <div><div style="font-size:10px;color:#6B7280;margin-bottom:2px;text-transform:uppercase;letter-spacing:.5px">Total factur√© HT</div><div style="font-size:20px;font-weight:700;color:#1A1A2E">${fmt(total)} ‚Ç¨</div></div>
            <div style="text-align:right"><div style="font-size:10px;color:#6B7280;margin-bottom:2px;text-transform:uppercase;letter-spacing:.5px">Taux de recouvrement</div><div style="font-size:20px;font-weight:700;color:#047857">${total?Math.round(DB.invoices.filter(i=>i.status==="paid").reduce((s,i)=>s+i.amount,0)/total*100):0}%</div></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">Co√ªts prestataires</div>
        <div class="card-body">${DB.freelances.map(f=>{const m=DB.missions.filter(x=>x.freelance_id===f.id);const t=m.reduce((s,x)=>s+x.amount,0);return `<div style="display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid #EEF0F5"><div><div style="font-size:12px;font-weight:700;color:#1A1A2E">${esc(f.name)}</div><div style="font-size:11px;color:#9CA3AF">${m.length} mission(s)</div></div><div style="text-align:right"><div style="font-size:14px;font-weight:700;color:#1B3A6B">${fmt(t)} ‚Ç¨</div>${badge(f.status)}</div></div>`;}).join("")}</div>
      </div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGS
function renderLogs() {
  document.getElementById("logs-sub").textContent=`${DB.logs.length} entr√©es enregistr√©es`;
  document.getElementById("logs-tbody").innerHTML=[...DB.logs].reverse().map((l,i)=>`<tr>
    <td><span style="font-family:'Courier New',monospace;font-size:11px;color:#9CA3AF">${String(DB.logs.length-i).padStart(4,"0")}</span></td>
    <td><div style="display:flex;align-items:center;gap:8px"><div style="width:5px;height:5px;border-radius:50%;background:${l.action.includes("[AUTO]")?"#6D28D9":"#1B3A6B"};flex-shrink:0"></div><span style="font-size:12px">${esc(l.action)}</span></div></td>
    <td style="font-size:12px;color:#6B7280">${esc(l.user)}</td>
    <td><span style="font-family:'Courier New',monospace;font-size:11px;color:#9CA3AF">${esc(l.timestamp)}</span></td>
  </tr>`).join("");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PDF
function showPDF(type, id) {
  let data;
  if(type==="contract") data=DB.contracts.find(c=>c.id===id);
  else if(type==="quote") data=DB.quotes.find(q=>q.id===id);
  else if(type==="invoice") data=DB.invoices.find(i=>i.id===id);
  if(!data) return;
  const tl={contract:"CONTRAT",quote:"DEVIS",invoice:"FACTURE"}[type];
  document.getElementById("pdf-modal-title").textContent=`Aper√ßu ${tl} ‚Äî ${data.number}`;
  document.getElementById("pdf-content").innerHTML=buildPDF(type,data);
  openModal("modal-pdf");
}

function buildPDF(type, data) {
  const client=DB.clients.find(c=>c.id===data.client_id);
  const freelance=DB.freelances.find(f=>f.id===data.freelance_id);
  const party=client||freelance;
  const tl={contract:"CONTRAT",quote:"DEVIS",invoice:"FACTURE"}[type];
  const tva=Number(data.amount)*0.2, ttc=Number(data.amount)*1.2;
  const acompte=data.acompte||30;
  const ndaTexts={
    standard:"Une clause de confidentialit√© standard est incluse. Les parties s'engagent √† ne pas divulguer les informations confidentielles √©chang√©es dans le cadre du pr√©sent contrat pendant toute sa dur√©e et pour une p√©riode de 3 ans apr√®s son expiration.",
    renforcee:"Clause de confidentialit√© renforc√©e applicable. Un accord de non-divulgation (NDA) s√©par√© est requis et doit √™tre sign√© pr√©alablement √† l'ex√©cution du pr√©sent contrat. Dur√©e de confidentialit√© : 5 ans apr√®s la fin du contrat. Toute violation entra√Æne une indemnisation forfaitaire.",
    aucune:"Aucune clause de confidentialit√© sp√©cifique n'est stipul√©e dans le pr√©sent contrat."
  };
  return `<div class="pdf-wrap">
    <div class="pdf-header">
      <div>
        <div class="pdf-logo">CRG INTERNAL</div>
        <div class="pdf-logo-sub">Direction de Campagne</div>
        <div class="pdf-logo-sub">maholo.contact@gmail.com</div>
      </div>
      <div style="text-align:right">
        <div class="pdf-doc-title">${tl}</div>
        <div class="pdf-doc-num">${esc(data.number)}</div>
        <div style="font-size:10px;color:#666;margin-top:6px">Date d'√©mission : ${fmtDate(data.created_at)}</div>
        ${type==="invoice"?`<div style="font-size:10px;color:#B91C1C;font-weight:700;margin-top:2px">Date d'√©ch√©ance : ${fmtDate(data.due_date)}</div>`:""}
        ${type==="contract"?`<div style="font-size:10px;color:#555;margin-top:2px">P√©riode : ${fmtDate(data.start_date)} ‚Üí ${fmtDate(data.end_date)}</div>`:""}
      </div>
    </div>
    <div class="pdf-rule"></div>
    <div class="pdf-parties">
      <div class="pdf-party">
        <div class="pdf-plabel">√âmetteur</div>
        <div class="pdf-pname">CRG Internal</div>
        <div class="pdf-pinfo">Direction de Campagne</div>
        <div class="pdf-pinfo">maholo.contact@gmail.com</div>
      </div>
      ${party?`<div class="pdf-party">
        <div class="pdf-plabel">${type==="contract"?"Partie contractante":"Destinataire"}</div>
        <div class="pdf-pname">${esc(party.name)}</div>
        ${party.address?`<div class="pdf-pinfo">${esc(party.address)}</div>`:""}
        <div class="pdf-pinfo">${esc(party.email)}</div>
        ${party.phone?`<div class="pdf-pinfo">${esc(party.phone)}</div>`:""}
        ${party.siret?`<div class="pdf-pinfo">SIRET : ${esc(party.siret)}</div>`:""}
      </div>`:""}
    </div>
    <div class="pdf-object"><strong>Objet :</strong> ${esc(data.description||data.mission_description)}</div>
    ${type==="contract"&&data.lieu?`<div class="pdf-object"><strong>Lieu d'ex√©cution :</strong> ${esc(data.lieu)}</div>`:""}
    <table class="pdf-table">
      <thead class="pdf-thead"><tr>
        <th>D√©signation</th><th class="r">Qt√©</th><th class="r">P.U. HT</th><th class="r">Montant HT</th>
      </tr></thead>
      <tbody class="pdf-tbody">
        <tr>
          <td>${esc(data.description||data.mission_description)}</td>
          <td class="r">1</td>
          <td class="r">${fmt(data.amount)} ‚Ç¨</td>
          <td class="r" style="font-weight:700">${fmt(data.amount)} ‚Ç¨</td>
        </tr>
        ${type==="contract"&&data.acompte&&data.amount>0?`<tr style="background:#FFFBEB">
          <td style="font-style:italic;color:#666;font-size:11px">Acompte √† la signature (${acompte}%)</td>
          <td class="r" style="font-size:11px">1</td>
          <td class="r" style="font-size:11px">${fmt(Math.round(data.amount*acompte/100))} ‚Ç¨</td>
          <td class="r" style="font-weight:700;color:#B45309;font-size:11px">${fmt(Math.round(data.amount*acompte/100))} ‚Ç¨</td>
        </tr>`:""}
      </tbody>
    </table>
    <div class="pdf-totals-wrap">
      <table class="pdf-totals">
        <tr><td>Sous-total HT</td><td class="r">${fmt(data.amount)} ‚Ç¨</td></tr>
        <tr><td>TVA (20%)</td><td class="r">${fmt(tva)} ‚Ç¨</td></tr>
        <tr class="pdf-total-row"><td>Total TTC</td><td class="big">${fmt(ttc)} ‚Ç¨</td></tr>
      </table>
    </div>
    ${type==="contract"?`
    <div class="pdf-section">
      <div class="pdf-sec-title">Conditions particuli√®res</div>
      <div class="pdf-sec-text">${esc(data.conditions||"N√©ant.")}</div>
    </div>
    <div class="pdf-section">
      <div class="pdf-sec-title">Modalit√©s de paiement</div>
      <div class="pdf-sec-text">Acompte de ${acompte}% d√ª √† la signature, soit <strong>${fmt(Math.round((data.amount||0)*acompte/100))} ‚Ç¨ HT</strong>. Solde de ${100-acompte}% d√ª √† la livraison finale, soit <strong>${fmt(Math.round((data.amount||0)*(100-acompte)/100))} ‚Ç¨ HT</strong>. Paiement par virement bancaire sous 30 jours. P√©nalit√©s de retard : 3√ó le taux d'int√©r√™t l√©gal en vigueur.</div>
    </div>
    <div class="pdf-section">
      <div class="pdf-sec-title">Clause de confidentialit√©</div>
      <div class="pdf-sec-text">${ndaTexts[data.nda]||ndaTexts.standard}</div>
    </div>
    <div class="pdf-section">
      <div class="pdf-sec-title">Conditions g√©n√©rales</div>
      <div class="pdf-sec-text">Le pr√©sent contrat prend effet √† la date de signature des deux parties et est r√©gi par le droit fran√ßais. Toute modification devra faire l'objet d'un avenant √©crit sign√© des deux parties. En cas de litige, les parties s'engagent √† tenter une r√©solution amiable avant toute proc√©dure judiciaire. Juridiction comp√©tente : Tribunaux fran√ßais.</div>
    </div>
    <div class="pdf-sigs">
      <div class="pdf-sig">Signature et cachet<br><strong>CRG Internal ‚Äî Direction de Campagne</strong><br><br><br></div>
      <div class="pdf-sig">Signature et cachet<br><strong>${esc(party?.name||"La Partie")}</strong><br><br><br></div>
    </div>`:""}
    ${type==="quote"?`<div class="pdf-section"><div class="pdf-sec-title">Conditions de validit√©</div><div class="pdf-sec-text">Ce devis est valable 30 jours √† compter de sa date d'√©mission. Pour l'accepter, veuillez le retourner sign√© avec la mention ¬´ Bon pour accord ¬ª. Un acompte de 30% sera demand√© √† la signature du bon de commande.</div></div>`:""}
    ${type==="invoice"?`<div class="pdf-section"><div class="pdf-sec-title">Conditions de r√®glement</div><div class="pdf-sec-text">Paiement par virement bancaire √† r√©ception de facture. En cas de retard, des p√©nalit√©s de 3√ó le taux d'int√©r√™t l√©gal seront appliqu√©es, ainsi qu'une indemnit√© forfaitaire de 40 ‚Ç¨ pour frais de recouvrement (Art. L441-10 du Code de Commerce).</div></div>`:""}
    <div class="pdf-foot">
      <span>CRG Internal ‚Äî Document confidentiel ‚Äî Usage strictement interne</span>
      <span>G√©n√©r√© le ${new Date().toLocaleDateString("fr-FR")}</span>
      <span>Page 1 / 1</span>
    </div>
  </div>`;
}

function printPDF() {
  const content=document.getElementById("pdf-content").innerHTML;
  const win=window.open("","_blank");
  win.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Document CRG Internal</title><style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,Helvetica,sans-serif;padding:40px;color:#111;line-height:1.7;font-size:12px}
    .pdf-wrap{max-width:800px;margin:0 auto}
    .pdf-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:30px}
    .pdf-logo{font-size:22px;font-weight:700;color:#1B3A6B;letter-spacing:2px}
    .pdf-logo-sub{font-size:10px;color:#666;margin-top:2px}
    .pdf-doc-title{font-size:18px;font-weight:700;color:#1B3A6B;text-align:right;text-transform:uppercase;letter-spacing:1px}
    .pdf-doc-num{font-size:14px;font-weight:700;color:#374151;margin-top:4px;text-align:right}
    .pdf-rule{height:2px;background:#1B3A6B;margin-bottom:24px}
    .pdf-parties{display:flex;gap:48px;margin-bottom:22px}
    .pdf-party{flex:1}
    .pdf-plabel{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;color:#999;margin-bottom:5px;border-bottom:1px solid #E5E7EB;padding-bottom:4px}
    .pdf-pname{font-weight:700;font-size:13px;margin-bottom:2px}
    .pdf-pinfo{color:#555;font-size:11px}
    .pdf-object{background:#F8F9FB;border:1px solid #E5E7EB;padding:9px 12px;margin-bottom:18px;font-size:12px}
    .pdf-table{width:100%;border-collapse:collapse;margin-bottom:16px}
    .pdf-thead tr{background:#1B3A6B;color:#fff}
    .pdf-thead th{padding:8px 12px;text-align:left;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em}
    .pdf-thead th.r,.pdf-tbody td.r{text-align:right}
    .pdf-tbody td{padding:10px 12px;border-bottom:1px solid #E5E7EB;font-size:12px}
    .pdf-totals-wrap{display:flex;justify-content:flex-end;margin-bottom:16px}
    .pdf-totals{border-collapse:collapse;min-width:260px}
    .pdf-totals td{padding:4px 12px;font-size:11px;color:#555}
    .pdf-totals td.r{text-align:right}
    .pdf-total-row td{padding:9px 12px;font-weight:700;font-size:13px;border-top:2px solid #1B3A6B;background:#F8F9FB}
    .pdf-total-row td.big{font-size:18px;font-weight:700;color:#1B3A6B;text-align:right}
    .pdf-section{margin-top:20px;border-top:1px solid #E5E7EB;padding-top:14px}
    .pdf-sec-title{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:#1B3A6B;margin-bottom:6px}
    .pdf-sec-text{font-size:10.5px;color:#444;line-height:1.8}
    .pdf-sigs{margin-top:24px;display:flex;gap:48px}
    .pdf-sig{flex:1;border-top:1px solid #999;padding-top:6px;font-size:10px;color:#666}
    .pdf-foot{margin-top:28px;padding-top:12px;border-top:1px solid #E5E7EB;display:flex;justify-content:space-between;font-size:9px;color:#bbb}
    @media print{body{padding:20px}}
  </style></head><body>${content}</body></html>`);
  win.document.close();
  win.onload=()=>win.print();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL HELPERS
function openModal(id) {
  if(id==="modal-new-contract"||id==="modal-new-quote"||id==="modal-new-invoice") populateSelects();
  document.getElementById(id).style.display="flex";
}
function closeModal(id) { document.getElementById(id).style.display="none"; }
function populateSelects() {
  ["ct-client","q-client","inv-client"].forEach(sid=>{
    const s=document.getElementById(sid); if(!s)return;
    s.innerHTML='<option value="">‚Äî S√©lectionner un client ‚Äî</option>'+DB.clients.map(c=>`<option value="${c.id}">${esc(c.name)}</option>`).join("");
  });
  const fl=document.getElementById("ct-freelance");
  if(fl) fl.innerHTML='<option value="">‚Äî S√©lectionner un freelance ‚Äî</option>'+DB.freelances.map(f=>`<option value="${f.id}">${esc(f.name)}</option>`).join("");
  const iq=document.getElementById("inv-quote");
  if(iq) iq.innerHTML='<option value="">Aucun devis li√©</option>'+DB.quotes.filter(q=>q.status==="accepted").map(q=>`<option value="${q.id}">${esc(q.number)} ‚Äî ${esc(q.description.slice(0,40))}</option>`).join("");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST
function showToast(msg, type="success") {
  const t=document.createElement("div");
  t.className=`toast ${type}`;
  t.textContent=msg;
  document.getElementById("toast-container").appendChild(t);
  setTimeout(()=>t.remove(),3000);
}
</script>
</body>
</html>
